<!DOCTYPE html>
<html>
<head>
    <title>route</title>
</head>
<body>
    <nav>
        <a class="link" href="/1">go to 1</a>
        <a class="link" href="/2">go to 2</a>
        <a class="link" href="/3">go to 3</a>
        <a class="link" href="/4">go to 4</a>
    </nav>
    <div id="app"></div>
    <script>
        const div1 = document.createElement('div')
        div1.innerText = '1'

        const div2 = document.createElement('div')
        div2.innerText = '2'

        const div3 = document.createElement('div')
        div3.innerText = '3'

        const div4 = document.createElement('div')
        div4.innerText = '4'

        const div404 = document.createElement('div')
        div404.innerText = 'Page Not Found!'

        const routeTable = {
            '/': div1,
            '/1': div1,
            '/2': div2,
            '/3': div3,
            '/4': div4,
            '/404': div404
        }

        function route() {
            // let number = window.location.hash.substr(1)
            let number = window.location.pathname
            let app = document.querySelector('#app')

            number = number || '/1'
console.log(number)
            // 获取界面
            let div = routeTable[number] || routeTable['/404']
            div.style.display = 'block'

            app.innerHTML = ''
            app.appendChild(div)

        }

        route()
        // window.addEventListener('hashchange', route)

        const allA = document.querySelectorAll('a.link')
        for (const a of allA) {
            a.addEventListener('click', function(e) {
                e.preventDefault();
                const href = this.getAttribute('href')
                window.history.pushState(null, `page${href}`, href)
                onStateChange(href)
            })
        }


        function onStateChange(href) {
            console.log('push state')
            route()
        }

        window.addEventListener('popstate', () => {
            console.log('pop state')
            route()
        })
 
    </script>
</body>
</html>